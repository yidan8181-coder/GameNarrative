<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Šæœ€åç”Ÿè¿˜è€…1-é‡ç½®ç‰ˆã€‹å™äº‹è®¾è®¡åˆ†æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Post-Apocalyptic Nature. Background: Warm Stone/Dark Grey. Accents: Firefly Green (Hope), Rust Orange (Violence/Decay), Muted White (Text). -->
    <!-- Application Structure Plan: The app is designed as a 'Narrative Director's Dashboard'. 
         1. 'Narrative Ecosystem': Breaks down the system design (NPCs, Environment).
         2. 'The Four Seasons Script': An interactive timeline allowing users to explore the specific themes and emotional beats of each chapter.
         3. 'Character Psyche': Uses data visualization to track the evolution of Joel and Ellie's traits.
         4. 'Thematic Core': Interactive cards exploring the deep themes (Love, Selfishness).
         5. 'AI Narrative Lab': Gemini-powered features with SAFE Client-Side Key Management (BYOK).
         Rationale: This structure separates the 'How' (System) from the 'What' (Script) and 'Who' (Characters), allowing a holistic view of the game's design. -->
    <!-- Visualization & Content Choices: 
         1. Line Chart (Chart.js): Visualizes 'Tension' vs 'Bonding' across the game's chapters. Goal: Show the pacing and narrative rhythm.
         2. Radar Chart (Chart.js): Compares Joel and Ellie's attributes (Trust, Violence, Hope, Survival) at the start vs. end. Goal: Visualize Character Arcs.
         3. Interactive Grid: For thematic keywords. Goal: Allow users to drill down into abstract concepts like 'Selfishness'.
         CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background-color: #1c1917; /* stone-900 */
            color: #e7e5e4; /* stone-200 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        .nav-active {
            border-bottom: 2px solid #22c55e; /* green-500 */
            color: #22c55e;
        }
        .glass-panel {
            background: rgba(41, 37, 36, 0.7); /* stone-800 with opacity */
            backdrop-filter: blur(10px);
            border: 1px solid #44403c; /* stone-700 */
        }
        .season-btn.active {
            background-color: #44403c;
            border-left: 4px solid #22c55e;
        }
        /* Loading animation for AI */
        .dot-flashing {
            position: relative;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #22c55e;
            color: #22c55e;
            animation: dot-flashing 1s infinite linear alternate;
            animation-delay: 0.5s;
        }
        .dot-flashing::before, .dot-flashing::after {
            content: "";
            display: inline-block;
            position: absolute;
            top: 0;
        }
        .dot-flashing::before {
            left: -15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #22c55e;
            color: #22c55e;
            animation: dot-flashing 1s infinite alternate;
            animation-delay: 0s;
        }
        .dot-flashing::after {
            left: 15px;
            width: 10px;
            height: 10px;
            border-radius: 5px;
            background-color: #22c55e;
            color: #22c55e;
            animation: dot-flashing 1s infinite alternate;
            animation-delay: 1s;
        }
        @keyframes dot-flashing {
            0% { background-color: #22c55e; }
            50%, 100% { background-color: rgba(34, 197, 94, 0.2); }
        }
        
        /* Modal Styles */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-stone-900/95 border-b border-stone-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2">
                    <div class="w-3 h-8 bg-green-600 rounded-sm"></div>
                    <span class="font-bold text-xl tracking-wider text-stone-100">TLOU<span class="text-stone-500">_ARCHITECT</span></span>
                </div>
                <div class="hidden md:flex space-x-8 items-center">
                    <button onclick="scrollToSection('overview')" class="nav-item hover:text-green-500 transition-colors px-3 py-2 text-sm font-medium" id="nav-overview">æ€»è§ˆ</button>
                    <button onclick="scrollToSection('systems')" class="nav-item hover:text-green-500 transition-colors px-3 py-2 text-sm font-medium" id="nav-systems">å™äº‹ç³»ç»Ÿ</button>
                    <button onclick="scrollToSection('script')" class="nav-item hover:text-green-500 transition-colors px-3 py-2 text-sm font-medium" id="nav-script">å‰§æœ¬ç»“æ„</button>
                    <button onclick="scrollToSection('characters')" class="nav-item hover:text-green-500 transition-colors px-3 py-2 text-sm font-medium" id="nav-characters">è§’è‰²å¼§å…‰</button>
                    <button onclick="scrollToSection('ai-lab')" class="nav-item text-green-400 hover:text-green-300 transition-colors px-3 py-2 text-sm font-bold flex items-center gap-1" id="nav-ai">
                         <span>âœ¨</span> AI å®éªŒå®¤
                    </button>
                    <!-- Key Settings Button -->
                    <button onclick="openKeyModal()" class="ml-2 text-stone-500 hover:text-stone-300 transition-colors p-2" title="è®¾ç½® API Key">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Header / Intro -->
    <header id="overview" class="relative pt-20 pb-16 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto text-center">
        <h1 class="text-4xl md:text-6xl font-extrabold text-stone-100 mb-6 tracking-tight">
            ã€Šæœ€åç”Ÿè¿˜è€…1ã€‹<br><span class="text-green-600">å™äº‹è®¾è®¡</span>æ·±åº¦è§£ææ–‡æ¡£
        </h1>
        <p class="mt-4 max-w-2xl mx-auto text-xl text-stone-400">
            å…³äºæ²‰æµ¸å¼ä½“éªŒã€æƒ…æ„Ÿå‰§æœ¬æ¶æ„ä¸æœ«ä¸–äººæ€§åšå¼ˆçš„ç³»ç»Ÿæ€§ç ”ç©¶
        </p>
        <div class="mt-10 flex justify-center gap-4">
            <div class="px-6 py-3 rounded-lg bg-stone-800 border border-stone-700">
                <span class="block text-2xl font-bold text-green-500">10/10</span>
                <span class="text-xs text-stone-500 uppercase tracking-widest">æ²‰æµ¸æ„Ÿ</span>
            </div>
            <div class="px-6 py-3 rounded-lg bg-stone-800 border border-stone-700">
                <span class="block text-2xl font-bold text-amber-500">4 Seasons</span>
                <span class="text-xs text-stone-500 uppercase tracking-widest">å‰§æœ¬ç»“æ„</span>
            </div>
            <div class="px-6 py-3 rounded-lg bg-stone-800 border border-stone-700">
                <span class="block text-2xl font-bold text-stone-300">2 Arcs</span>
                <span class="text-xs text-stone-500 uppercase tracking-widest">æ ¸å¿ƒè§’è‰²</span>
            </div>
        </div>
        <p class="mt-8 text-sm text-stone-500 max-w-3xl mx-auto">
            æœ¬äº¤äº’å¼æ–‡æ¡£æ—¨åœ¨è§£æ„é¡½çš®ç‹—å·¥ä½œå®¤åœ¨ã€Šæœ€åç”Ÿè¿˜è€…1-é‡ç½®ç‰ˆã€‹ä¸­è¿ç”¨çš„é«˜çº§å™äº‹æŠ€æ³•ã€‚æˆ‘ä»¬å°†ä»åº•å±‚çš„å™äº‹ç³»ç»Ÿè®¾è®¡ï¼ˆGameplay Narrativeï¼‰å‡ºå‘ï¼Œæ·±å…¥å‰–ææŒ‰å­£èŠ‚åˆ’åˆ†çš„å‰§æœ¬ç»“æ„ï¼Œå¹¶ç”¨æ•°æ®åŒ–æ‰‹æ®µé‡åŒ–ä¹”å°”ä¸è‰¾è‰çš„è§’è‰²æˆé•¿å¼§å…‰ã€‚
        </p>
    </header>

    <!-- Section 1: Narrative Systems -->
    <section id="systems" class="py-16 bg-stone-800/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-stone-100 border-l-4 border-green-600 pl-4">å™äº‹ç³»ç»Ÿæ¶æ„</h2>
                <p class="mt-4 text-stone-400 max-w-3xl">
                    ã€Šæœ€åç”Ÿè¿˜è€…ã€‹çš„å™äº‹ä¸ä»…ä¾èµ–è¿‡åœºåŠ¨ç”»ï¼Œæ›´æ·±æ·±æ¤æ ¹äºGameplayä¹‹ä¸­ã€‚è¿™ç§â€œå»UIåŒ–â€çš„æ²‰æµ¸å¼è®¾è®¡ä¸é«˜æ™ºèƒ½NPCè¡¨æ¼”ï¼Œå…±åŒæ„å»ºäº†çœŸå®å¯ä¿¡çš„æœ«ä¸–èˆå°ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Card 1 -->
                <div class="glass-panel p-6 rounded-xl hover:bg-stone-800 transition-all duration-300 cursor-pointer group" onclick="updateSystemDetail(0)">
                    <div class="text-3xl mb-4 group-hover:scale-110 transition-transform duration-300">ğŸ­</div>
                    <h3 class="text-xl font-bold text-stone-200 mb-2">ç¨‹åºåŒ–è¡¨æ¼”ä¸NPCäº¤äº’</h3>
                    <p class="text-sm text-stone-400">NPCå¹¶éå•çº¯çš„æˆ˜æ–—AIï¼Œè€Œæ˜¯å…·å¤‡æƒ…æ„Ÿé€»è¾‘çš„æ•°å­—æ¼”å‘˜ã€‚è‰¾è‰çš„è·Ÿéšã€æ©æŠ¤ã€ç”šè‡³æ— èŠæ—¶çš„å“¼æ­Œï¼Œéƒ½åœ¨æ½œç§»é»˜åŒ–åœ°å»ºç«‹ç¾ç»Šã€‚</p>
                </div>
                <!-- Card 2 -->
                <div class="glass-panel p-6 rounded-xl hover:bg-stone-800 transition-all duration-300 cursor-pointer group" onclick="updateSystemDetail(1)">
                    <div class="text-3xl mb-4 group-hover:scale-110 transition-transform duration-300">ğŸ—ºï¸</div>
                    <h3 class="text-xl font-bold text-stone-200 mb-2">ç¯å¢ƒå™äº‹ (Environmental Storytelling)</h3>
                    <p class="text-sm text-stone-400">æ¯ä¸€ä¸ªæˆ¿é—´éƒ½åœ¨è®²è¿°ä¸€ä¸ªæ•…äº‹ã€‚é€šè¿‡æ•£è½çš„ä¿¡ä»¶ã€æ‘†æ”¾çš„å°¸ä½“ã€å¢™ä¸Šçš„æ¶‚é¸¦ï¼Œæ„å»ºäº†ä¸€ä¸ªæ— éœ€è¨€è¯­çš„æ‚²å‰§ä¸–ç•Œã€‚</p>
                </div>
                <!-- Card 3 -->
                <div class="glass-panel p-6 rounded-xl hover:bg-stone-800 transition-all duration-300 cursor-pointer group" onclick="updateSystemDetail(2)">
                    <div class="text-3xl mb-4 group-hover:scale-110 transition-transform duration-300">ğŸ®</div>
                    <h3 class="text-xl font-bold text-stone-200 mb-2">æ¸¸æˆæœºåˆ¶ä¸å™äº‹çš„ç»Ÿä¸€ (Ludonarrative)</h3>
                    <p class="text-sm text-stone-400">èµ„æºçš„æåº¦åŒ®ä¹è¿«ä½¿ç©å®¶ä½“éªŒâ€œç”Ÿå­˜â€çš„å‹åŠ›ï¼Œæ¯ä¸€æ¬¡æš´åŠ›è¡Œä¸ºéƒ½æ˜¾å¾—æ²‰é‡ï¼Œä»è€Œåœ¨æœºåˆ¶ä¸Šå¼ºåŒ–äº†å‰§æœ¬çš„ç»æœ›æ„Ÿã€‚</p>
                </div>
            </div>

            <!-- Dynamic Detail Box -->
            <div id="system-detail-box" class="mt-8 p-6 bg-stone-900 border border-stone-700 rounded-lg hidden">
                <h4 id="sys-detail-title" class="text-lg font-bold text-green-500 mb-2">è¯¦ç»†åˆ†æ</h4>
                <p id="sys-detail-text" class="text-stone-300 leading-relaxed"></p>
            </div>
        </div>
    </section>

    <!-- Section 2: Script Structure & Emotional Curve -->
    <section id="script" class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10 flex flex-col md:flex-row justify-between items-end">
                <div>
                    <h2 class="text-3xl font-bold text-stone-100 border-l-4 border-amber-600 pl-4">å‰§æœ¬ç»“æ„ä¸æƒ…æ„Ÿæ›²çº¿</h2>
                    <p class="mt-4 text-stone-400 max-w-3xl">
                        æ¸¸æˆå‰§æœ¬ä¸¥æ ¼éµå¾ªå››å­£æ›´æ›¿çš„æ—¶é—´çº¿ï¼Œæ¯ä¸€ä¸ªå­£èŠ‚ä¸ä»…ä»£è¡¨æ—¶é—´çš„æµé€ï¼Œæ›´éšå–»äº†äººç‰©å…³ç³»çš„é˜¶æ®µæ€§è½¬å˜ã€‚ä¸‹æ–¹å›¾è¡¨å±•ç¤ºäº†éšç€ç« èŠ‚æ¨è¿›ï¼Œæ¸¸æˆå†…çš„â€œç”Ÿå­˜ç´§å¼ åº¦â€ä¸ä¹”å°”è‰¾è‰â€œæƒ…æ„Ÿäº²å¯†åº¦â€çš„å¯¹æ¯”ã€‚
                    </p>
                </div>
            </div>

            <!-- Layout: Chart on Left, Interactive List on Right -->
            <div class="flex flex-col lg:flex-row gap-8">
                <!-- Chart Section -->
                <div class="w-full lg:w-2/3 glass-panel p-4 rounded-xl">
                    <div class="chart-container">
                        <canvas id="emotionalCurveChart"></canvas>
                    </div>
                    <div class="mt-4 flex justify-center gap-6 text-sm">
                        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-amber-600 rounded-full"></span>ç”Ÿå­˜ç´§å¼ åº¦ (Tension)</div>
                        <div class="flex items-center gap-2"><span class="w-3 h-3 bg-green-500 rounded-full"></span>æƒ…æ„Ÿç¾ç»Š (Bonding)</div>
                    </div>
                </div>

                <!-- Interactive Seasons Selector -->
                <div class="w-full lg:w-1/3 flex flex-col gap-2">
                    <button onclick="updateSeasonData('summer')" class="season-btn active w-full text-left p-4 rounded-lg bg-stone-800 hover:bg-stone-700 transition-all group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-lg text-stone-200">å¤å­£ (Summer)</span>
                            <span class="text-xs text-amber-500 bg-amber-900/30 px-2 py-1 rounded">ç›¸é‡ä¸ä»»åŠ¡</span>
                        </div>
                        <p class="text-xs text-stone-400 mt-1 group-hover:text-stone-300">éš”ç¦»åŒº -> æ¯”å°”å°é•‡ -> åŒ¹å…¹å ¡</p>
                    </button>
                    
                    <button onclick="updateSeasonData('fall')" class="season-btn w-full text-left p-4 rounded-lg bg-stone-800 hover:bg-stone-700 transition-all group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-lg text-stone-200">ç§‹å­£ (Fall)</span>
                            <span class="text-xs text-green-500 bg-green-900/30 px-2 py-1 rounded">å†²çªä¸ç£¨åˆ</span>
                        </div>
                        <p class="text-xs text-stone-400 mt-1 group-hover:text-stone-300">æ±¤ç±³å¤§å -> å¤§å­¦</p>
                    </button>

                    <button onclick="updateSeasonData('winter')" class="season-btn w-full text-left p-4 rounded-lg bg-stone-800 hover:bg-stone-700 transition-all group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-lg text-stone-200">å†¬å­£ (Winter)</span>
                            <span class="text-xs text-blue-400 bg-blue-900/30 px-2 py-1 rounded">åè½¬ä¸ä¾èµ–</span>
                        </div>
                        <p class="text-xs text-stone-400 mt-1 group-hover:text-stone-300">æ¹–ç•”åº¦å‡æ‘ -> çŒäººè¥åœ°</p>
                    </button>

                    <button onclick="updateSeasonData('spring')" class="season-btn w-full text-left p-4 rounded-lg bg-stone-800 hover:bg-stone-700 transition-all group">
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-lg text-stone-200">æ˜¥å­£ (Spring)</span>
                            <span class="text-xs text-pink-400 bg-pink-900/30 px-2 py-1 rounded">é«˜æ½®ä¸è°è¨€</span>
                        </div>
                        <p class="text-xs text-stone-400 mt-1 group-hover:text-stone-300">ç›æ¹–åŸ -> åŒ»é™¢ -> æ°å…‹é€Š</p>
                    </button>
                    
                    <!-- Dynamic Content Panel -->
                    <div id="season-content" class="mt-4 p-4 border-t border-stone-700">
                        <h4 class="text-green-500 font-bold mb-2">å¤å­£æ ¸å¿ƒä¸»é¢˜ï¼šå¤±å»ä¸è´£ä»»</h4>
                        <p class="text-sm text-stone-300">
                            æ•…äº‹çš„å¼€ç«¯ã€‚ä¹”å°”æ˜¯ä¸€ä¸ªå°é—­å†…å¿ƒçš„èµ°ç§å®¢ï¼Œè‰¾è‰æ˜¯â€œè´§ç‰©â€ã€‚
                            <br><br>
                            <strong>å…³é”®äº‹ä»¶ï¼š</strong> æ³°ä¸çš„ç‰ºç‰²è¿«ä½¿ä¹”å°”æ¥æ‰‹è¿™ä»½â€œè´£ä»»â€ã€‚æ­¤æ—¶ä¸¤äººçš„å…³ç³»çº¯ç²¹å»ºç«‹åœ¨åˆ©ç›Šä¸æ‰¿è¯ºä¹‹ä¸Šï¼Œä¹”å°”æåŠ›é¿å…æƒ…æ„ŸæŠ•å…¥ã€‚
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 3: Character Arcs (Data Analysis) -->
    <section id="characters" class="py-16 bg-stone-800/30">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-stone-100 border-l-4 border-blue-500 pl-4">è§’è‰²å¼§å…‰é‡åŒ–åˆ†æ</h2>
                <p class="mt-4 text-stone-400 max-w-3xl">
                    ã€Šæœ€åç”Ÿè¿˜è€…ã€‹çš„ä¼Ÿå¤§ä¹‹å¤„åœ¨äºè§’è‰²çš„åŠ¨æ€æˆé•¿ã€‚æˆ‘ä»¬é€šè¿‡å››ä¸ªç»´åº¦ï¼šç”Ÿå­˜èƒ½åŠ›ã€äººæ€§/å¸Œæœ›ã€å¯¹ä»–äººçš„ä¿¡ä»»ã€åˆ›ä¼¤ç¨‹åº¦ï¼Œæ¥å¯¹æ¯”æ•…äº‹å¼€å§‹ï¼ˆStartï¼‰ä¸ç»“æŸï¼ˆEndï¼‰æ—¶è§’è‰²çš„å¿ƒç†çŠ¶æ€å˜åŒ–ã€‚
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                <!-- Controls & Text -->
                <div>
                    <div class="flex gap-4 mb-6">
                        <button onclick="updateCharacterChart('joel')" id="btn-joel" class="px-6 py-2 bg-stone-700 hover:bg-stone-600 text-white rounded-full transition-colors font-bold border-2 border-green-600">ä¹”å°” (Joel)</button>
                        <button onclick="updateCharacterChart('ellie')" id="btn-ellie" class="px-6 py-2 bg-stone-800 hover:bg-stone-700 text-stone-400 rounded-full transition-colors font-bold border-2 border-transparent">è‰¾è‰ (Ellie)</button>
                    </div>
                    
                    <div id="char-desc" class="space-y-4">
                        <h3 class="text-2xl font-bold text-stone-100">ä¹”å°”ï¼šä»ç”Ÿå­˜æœºå™¨åˆ°è‡ªç§çš„çˆ¶äº²</h3>
                        <p class="text-stone-300">
                            æ•…äº‹å¼€å§‹æ—¶ï¼Œä¹”å°”æ˜¯ä¸€ä¸ªæƒ…æ„Ÿæ¯ç«­çš„ç”Ÿå­˜è€…ï¼Œä»–çš„â€œäººæ€§â€æä½ï¼Œä¾é å†·é…·ç»´æŒç”Ÿå­˜ã€‚éšç€æ—…ç¨‹æ¨è¿›ï¼Œè‰¾è‰å”¤é†’äº†ä»–å†…å¿ƒæ·±å¤„çš„çˆ¶çˆ±ã€‚
                        </p>
                        <p class="text-stone-300 border-l-2 border-stone-600 pl-4 italic">
                            â€œæˆ‘å¥‹æ–—äº†å¾ˆä¹…ï¼Œæ‰å¾—ä»¥ç”Ÿå­˜è‡³ä»Š...æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½è¦æ‰¾åˆ°ä»¥æ­¤ä¸ºç”Ÿçš„æ„ä¹‰ã€‚â€
                        </p>
                        <ul class="space-y-2 mt-4 text-sm text-stone-400">
                            <li class="flex items-center"><span class="text-green-500 mr-2">â–²</span> äººæ€§/å¸Œæœ›ï¼šå¤§å¹…å›å‡ï¼ˆå› ä¸ºè‰¾è‰ï¼‰</li>
                            <li class="flex items-center"><span class="text-green-500 mr-2">â–²</span> ä¿¡ä»»ï¼šä»…å¯¹è‰¾è‰å®Œå…¨æ•å¼€</li>
                            <li class="flex items-center"><span class="text-amber-500 mr-2">â–¼</span> åˆ›ä¼¤ï¼šçœ‹ä¼¼æ²»æ„ˆï¼Œå®åˆ™è½¬åŒ–ä¸ºå¯¹å¤±å»çš„ææƒ§</li>
                        </ul>
                    </div>
                </div>

                <!-- Radar Chart -->
                <div class="glass-panel p-6 rounded-xl flex justify-center items-center">
                    <div class="chart-container" style="max-width: 500px; height: 400px;">
                        <canvas id="characterRadarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Thematic Deconstruction (Interactive Cards) -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-stone-100 border-l-4 border-stone-100 pl-4 mb-8">æ ¸å¿ƒä¸»é¢˜è§£æ„</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <div class="theme-card bg-stone-800 p-6 rounded-lg cursor-pointer hover:-translate-y-1 transition-transform border-t-2 border-pink-500" onclick="expandTheme(this, 'love')">
                    <h3 class="text-xl font-bold text-pink-500 mb-2">çˆ± (Love)</h3>
                    <p class="text-xs text-stone-400">ç‚¹å‡»å±•å¼€è§£æ</p>
                    <div class="hidden-content hidden mt-4 text-sm text-stone-300">
                        åœ¨TLOUä¸­ï¼Œçˆ±å¹¶éçº¯ç²¹çš„ç¾å¥½ï¼Œå®ƒæ˜¯ä¸€ç§<strong>å±é™©çš„é©±åŠ¨åŠ›</strong>ã€‚ä¹”å°”å¯¹è‰¾è‰çš„çˆ±æœ€ç»ˆå¯¼è‡´äº†ä»–èƒŒå›å…¨äººç±»çš„å†³å®šã€‚è¿™ç§çˆ±æ˜¯æ’ä»–æ€§çš„ã€è‡ªç§çš„ï¼Œä½†ä¹Ÿå› æ­¤æ˜¾å¾—æ— æ¯”çœŸå®å’Œæ²‰é‡ã€‚
                    </div>
                </div>

                <div class="theme-card bg-stone-800 p-6 rounded-lg cursor-pointer hover:-translate-y-1 transition-transform border-t-2 border-stone-400" onclick="expandTheme(this, 'selfishness')">
                    <h3 class="text-xl font-bold text-stone-200 mb-2">è‡ªç§ (Selfishness)</h3>
                    <p class="text-xs text-stone-400">ç‚¹å‡»å±•å¼€è§£æ</p>
                    <div class="hidden-content hidden mt-4 text-sm text-stone-300">
                        ä¹”å°”æœ€åçš„é€‰æ‹©æ˜¯æåº¦è‡ªç§çš„ã€‚ä»–å‰¥å¤ºäº†è‰¾è‰çŸ¥æƒ…å’Œé€‰æ‹©çš„æƒåˆ©ï¼Œåªä¸ºå¡«è¡¥è‡ªå·±å¤±å»å¥³å„¿çš„ç©ºæ´ã€‚è¿™æ‰“ç ´äº†ä¼ ç»Ÿè‹±é›„å™äº‹çš„å¥—è·¯ï¼Œå±•ç°äº†äººæ€§çš„ç°åº¦ã€‚
                    </div>
                </div>

                <div class="theme-card bg-stone-800 p-6 rounded-lg cursor-pointer hover:-translate-y-1 transition-transform border-t-2 border-green-600" onclick="expandTheme(this, 'growth')">
                    <h3 class="text-xl font-bold text-green-600 mb-2">æˆé•¿ (Growth)</h3>
                    <p class="text-xs text-stone-400">ç‚¹å‡»å±•å¼€è§£æ</p>
                    <div class="hidden-content hidden mt-4 text-sm text-stone-300">
                        è‰¾è‰çš„æˆé•¿æœ€ä¸ºæ˜¾è‘—ï¼Œå°¤å…¶æ˜¯åœ¨å†¬å­£ç« èŠ‚ã€‚å¥¹ä»éœ€è¦ä¿æŠ¤çš„â€œè´§ç‰©â€è½¬å˜ä¸ºèƒ½å¤Ÿç‹¬ç«‹çŒæ€å¤§å«çš„ç”Ÿå­˜è€…ã€‚è¿™ç§æˆé•¿ä¼´éšç€çº¯çœŸçš„ä¸§å¤±å’Œæš´åŠ›çš„è§‰é†’ã€‚
                    </div>
                </div>

                <div class="theme-card bg-stone-800 p-6 rounded-lg cursor-pointer hover:-translate-y-1 transition-transform border-t-2 border-red-800" onclick="expandTheme(this, 'death')">
                    <h3 class="text-xl font-bold text-red-700 mb-2">æ­»äº¡ (Death)</h3>
                    <p class="text-xs text-stone-400">ç‚¹å‡»å±•å¼€è§£æ</p>
                    <div class="hidden-content hidden mt-4 text-sm text-stone-300">
                        æ¸¸æˆä¸­çš„æ­»äº¡çªå¦‚å…¶æ¥ä¸”æ²¡æœ‰å°Šä¸¥ï¼ˆå¦‚äº¨åˆ©å…„å¼Ÿï¼‰ã€‚å®ƒæ—¶åˆ»æé†’ç©å®¶æœ«ä¸–çš„æ®‹é…·ï¼Œä¹Ÿåè¡¬å‡ºè§’è‰²ä¹‹é—´æƒ…æ„Ÿè¿æ¥çš„å¯è´µã€‚
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- New Section 5: AI Narrative Lab (Gemini API Integrated) -->
    <section id="ai-lab" class="py-16 pb-24 bg-stone-900 border-t border-stone-800 relative overflow-hidden">
        <!-- Subtle background glow -->
        <div class="absolute top-0 right-0 w-96 h-96 bg-green-900/10 blur-3xl rounded-full pointer-events-none"></div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="mb-10 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                    <div class="flex items-center gap-3">
                        <h2 class="text-3xl font-bold text-stone-100 border-l-4 border-green-500 pl-4">AI å™äº‹å®éªŒå®¤</h2>
                        <span class="px-2 py-1 bg-green-900/30 border border-green-700 text-green-400 text-xs rounded font-bold uppercase tracking-wider">Gemini Powered</span>
                    </div>
                    <p class="mt-4 text-stone-400 max-w-3xl">
                        åˆ©ç”¨ Gemini å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œæ¢ç´¢æ¸¸æˆå™äº‹çš„æ— é™å¯èƒ½ã€‚å‘â€œæ•°å­—å™äº‹æ€»ç›‘â€æé—®ï¼Œæˆ–æ¨æ¼”å¹³è¡Œæ—¶ç©ºçš„è´è¶æ•ˆåº”ã€‚
                    </p>
                </div>
                <button onclick="openKeyModal()" class="px-4 py-2 bg-stone-800 hover:bg-stone-700 border border-stone-600 rounded text-stone-300 text-sm flex items-center gap-2 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    é…ç½® API Key
                </button>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <!-- Feature 1: Narrative Oracle -->
                <div class="glass-panel p-6 rounded-xl border border-stone-700 flex flex-col h-full">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-2xl">ğŸ”®</span>
                        <h3 class="text-xl font-bold text-stone-200">âœ¨ å™äº‹ç¥è°• (Narrative Oracle)</h3>
                    </div>
                    <p class="text-sm text-stone-400 mb-4">
                        å¯¹å‰§æƒ…ç»†èŠ‚ã€è§’è‰²åŠ¨æœºæˆ–è®¾è®¡æ„å›¾æœ‰ç–‘é—®ï¼Ÿè¾“å…¥ä½ çš„é—®é¢˜ï¼ŒAI å°†ä»ä¸“ä¸šå™äº‹è®¾è®¡çš„è§’åº¦ä¸ºä½ è§£æã€‚
                    </p>
                    <div class="flex-grow flex flex-col gap-3">
                        <textarea id="oracle-input" class="w-full bg-stone-950 border border-stone-700 rounded-lg p-3 text-stone-300 text-sm focus:border-green-500 focus:ring-1 focus:ring-green-500 outline-none resize-none h-24" placeholder="ä¾‹å¦‚ï¼šä¸ºä»€ä¹ˆæ³°ä¸çš„æ­»æ˜¯ä¹”å°”è½¬å˜çš„å…³é”®ï¼Ÿ"></textarea>
                        <button onclick="askOracle()" class="w-full py-2 bg-stone-800 hover:bg-stone-700 text-green-400 font-bold rounded-lg border border-stone-600 transition-colors flex justify-center items-center gap-2">
                            <span>å‘ç¥è°•æé—®</span>
                            <span id="oracle-loading" class="dot-flashing hidden ml-2"></span>
                        </button>
                        <div id="oracle-result" class="bg-stone-950/50 p-4 rounded-lg border border-stone-800 min-h-[120px] max-h-[200px] overflow-y-auto text-sm text-stone-300 hidden"></div>
                    </div>
                </div>

                <!-- Feature 2: What-If Simulator -->
                <div class="glass-panel p-6 rounded-xl border border-stone-700 flex flex-col h-full">
                    <div class="flex items-center gap-2 mb-4">
                        <span class="text-2xl">ğŸŒŒ</span>
                        <h3 class="text-xl font-bold text-stone-200">âœ¨ å¹³è¡Œå®‡å®™æ¨æ¼” (What-If)</h3>
                    </div>
                    <p class="text-sm text-stone-400 mb-4">
                        å¦‚æœå…³é”®äº‹ä»¶å‘ç”Ÿäº†æ”¹å˜ï¼Ÿè¾“å…¥ä¸€ä¸ªâ€œå¦‚æœâ€åœºæ™¯ï¼ŒAI å°†æ¨æ¼”å®ƒå¯¹ç»“å±€å’Œä¸»é¢˜çš„è´è¶æ•ˆåº”ã€‚
                    </p>
                    <div class="flex-grow flex flex-col gap-3">
                        <div class="flex gap-2">
                            <input id="whatif-input" type="text" class="flex-1 bg-stone-950 border border-stone-700 rounded-lg p-3 text-stone-300 text-sm focus:border-amber-500 focus:ring-1 focus:ring-amber-500 outline-none" placeholder="ä¾‹å¦‚ï¼šå¦‚æœèæ‹‰åœ¨åºç« ä¸­å¹¸å­˜ä¸‹æ¥...">
                        </div>
                        <button onclick="runSimulation()" class="w-full py-2 bg-stone-800 hover:bg-stone-700 text-amber-500 font-bold rounded-lg border border-stone-600 transition-colors flex justify-center items-center gap-2">
                            <span>å¯åŠ¨æ¨æ¼”</span>
                            <span id="whatif-loading" class="dot-flashing hidden ml-2"></span>
                        </button>
                         <div id="whatif-result" class="bg-stone-950/50 p-4 rounded-lg border border-stone-800 min-h-[120px] max-h-[200px] overflow-y-auto text-sm text-stone-300 hidden"></div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 border-t border-stone-800 py-8 text-center">
        <p class="text-stone-500 text-sm">Created for Game Narrative Analysis Study based on user request.</p>
        <p class="text-stone-600 text-xs mt-2">Â© The Last of Us Analysis Project</p>
    </footer>

    <!-- API Key Modal -->
    <div id="key-modal" class="fixed inset-0 z-[100] hidden">
        <div class="absolute inset-0 modal-backdrop" onclick="closeKeyModal()"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-stone-900 border border-stone-700 p-8 rounded-xl shadow-2xl w-[90%] max-w-md">
            <h3 class="text-2xl font-bold text-stone-100 mb-4">é…ç½® Gemini API Key</h3>
            <p class="text-stone-400 text-sm mb-6">
                ä¸ºäº†åœ¨å…¬å¼€ç½‘ç»œä¸Šå®‰å…¨è¿è¡Œ AI åŠŸèƒ½ï¼Œè¯·åœ¨æ­¤è¾“å…¥æ‚¨è‡ªå·±çš„ Google Gemini API Keyã€‚
                <br><br>
                <span class="text-xs text-stone-500">
                    * æ‚¨çš„å¯†é’¥å°†ä»…å­˜å‚¨åœ¨æ‚¨æµè§ˆå™¨çš„æœ¬åœ°ç¼“å­˜ (LocalStorage) ä¸­ï¼Œç»ä¸ä¼šå‘é€ç»™ä»»ä½•ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ã€‚
                </span>
            </p>
            
            <label class="block text-xs font-bold text-stone-500 uppercase mb-2">API Key</label>
            <input type="password" id="api-key-input" class="w-full bg-stone-950 border border-stone-700 rounded p-3 text-stone-100 mb-6 focus:border-green-500 focus:outline-none" placeholder="Paste your API key here...">
            
            <div class="flex justify-end gap-3">
                <button onclick="closeKeyModal()" class="px-4 py-2 text-stone-400 hover:text-stone-200">å–æ¶ˆ</button>
                <button onclick="saveApiKey()" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white font-bold rounded">ä¿å­˜å¯†é’¥</button>
            </div>
            
            <div class="mt-6 pt-4 border-t border-stone-800 text-center">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-xs text-green-500 hover:underline">æ²¡æœ‰å¯†é’¥ï¼Ÿç‚¹å‡»æ­¤å¤„å…è´¹è·å– (Google AI Studio)</a>
            </div>
        </div>
    </div>

    <!-- Logic -->
    <script>
        // --- Gemini API & Key Management ---
        
        // 1. Get Key function (Priority: Environment -> LocalStorage)
        function getApiKey() {
            // Check LocalStorage first (User set key)
            const storedKey = localStorage.getItem('gemini_api_key');
            if (storedKey) return storedKey;
            
            // Check Environment (for local dev/canvas)
            // Note: In a published static file, this will likely be empty, which is intended.
            if (typeof apiKey !== 'undefined' && apiKey) return apiKey;
            
            return null;
        }

        // 2. Modal Logic
        function openKeyModal() {
            const modal = document.getElementById('key-modal');
            const input = document.getElementById('api-key-input');
            const currentKey = localStorage.getItem('gemini_api_key');
            
            if (currentKey) input.value = currentKey;
            
            modal.classList.remove('hidden');
        }

        function closeKeyModal() {
            document.getElementById('key-modal').classList.add('hidden');
        }

        function saveApiKey() {
            const input = document.getElementById('api-key-input');
            const key = input.value.trim();
            
            if (key) {
                localStorage.setItem('gemini_api_key', key);
                alert("API Key å·²å®‰å…¨ä¿å­˜è‡³æœ¬åœ°ï¼");
                closeKeyModal();
            } else {
                alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ API Keyã€‚");
            }
        }

        // 3. Call API Helper
        async function callGeminiAPI(userPrompt, systemInstruction) {
            const key = getApiKey();
            
            if (!key) {
                // Trigger Modal if no key found
                openKeyModal();
                return "è¯·å…ˆé…ç½® API Key ä»¥ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚";
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${key}`;
            
            const payload = {
                contents: [{
                    parts: [{ text: userPrompt }]
                }],
                systemInstruction: {
                    parts: [{ text: systemInstruction }]
                }
            };

            // Retry logic
            const maxRetries = 3;
            let attempt = 0;
            
            while (attempt < maxRetries) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errData = await response.json();
                        if (errData.error && errData.error.message) {
                           throw new Error(`API Error: ${errData.error.message}`);
                        }
                        throw new Error(`HTTP Error: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "AI æš‚æ—¶æ— æ³•å›ç­”ï¼Œè¯·ç¨åå†è¯•ã€‚";

                } catch (error) {
                    console.error(`Attempt ${attempt + 1} failed:`, error);
                    attempt++;
                    
                    if (attempt === maxRetries) {
                        // Helpful error for user
                        if (error.message.includes('API Key') || error.message.includes('400')) {
                             return "API Key æ— æ•ˆæˆ–è¿‡æœŸï¼Œè¯·æ£€æŸ¥è®¾ç½®ã€‚";
                        }
                        return "è¿æ¥ AI æœåŠ¡å™¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•ã€‚";
                    }
                    await new Promise(r => setTimeout(r, 1000 * Math.pow(2, attempt - 1)));
                }
            }
        }

        // --- Feature 1: Narrative Oracle Logic ---
        async function askOracle() {
            const input = document.getElementById('oracle-input').value.trim();
            const resultBox = document.getElementById('oracle-result');
            const loading = document.getElementById('oracle-loading');
            
            if (!input) return;

            // Check Key first to avoid UI flash if modal opens
            if (!getApiKey()) {
                openKeyModal();
                return;
            }

            // UI State
            loading.classList.remove('hidden');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = '<span class="text-stone-500 italic">æ­£åœ¨è§£æå™äº‹æ•°æ®åº“...</span>';

            const systemPrompt = "ä½ æ˜¯ä¸€ä½ã€Šæœ€åç”Ÿè¿˜è€… (The Last of Us)ã€‹çš„èµ„æ·±å™äº‹è®¾è®¡å¸ˆå’Œæ¸¸æˆåˆ†æå¸ˆã€‚ä½ çš„ä»»åŠ¡æ˜¯é’ˆå¯¹ç”¨æˆ·å…³äºæ¸¸æˆå‰§æƒ…ã€è§’è‰²å¿ƒç†ã€ä¸»é¢˜éšå–»æˆ–è®¾è®¡æ„å›¾çš„æé—®ï¼Œæä¾›æ·±åº¦ã€ä¸“ä¸šä¸”å¯Œæœ‰æ´å¯ŸåŠ›çš„è§£æã€‚å›ç­”åº”ç®€æ´æœ‰åŠ›ï¼Œèšç„¦äºå™äº‹æŠ€å·§å’Œæƒ…æ„Ÿå½±å“ï¼Œé¿å…å•çº¯å¤è¿°å‰§æƒ…ã€‚";
            
            const response = await callGeminiAPI(input, systemPrompt);
            
            // Render Result (Simple Markdown to HTML conversion for bolding)
            const formattedResponse = response.replace(/\*\*(.*?)\*\*/g, '<strong class="text-green-400">$1</strong>');
            
            loading.classList.add('hidden');
            resultBox.innerHTML = formattedResponse;
        }

        // --- Feature 2: What-If Simulator Logic ---
        async function runSimulation() {
            const input = document.getElementById('whatif-input').value.trim();
            const resultBox = document.getElementById('whatif-result');
            const loading = document.getElementById('whatif-loading');
            
            if (!input) return;

            if (!getApiKey()) {
                openKeyModal();
                return;
            }

            // UI State
            loading.classList.remove('hidden');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = '<span class="text-stone-500 italic">æ­£åœ¨æ¨æ¼”å¹³è¡Œå®‡å®™æ—¶é—´çº¿...</span>';

            const systemPrompt = "ä½ æ˜¯ä¸€ä½æ“…é•¿æœ«ä¸–é¢˜æçš„åˆ›æ„ç¼–å‰§ã€‚ç”¨æˆ·å°†è¾“å…¥ä¸€ä¸ªå…³äºã€Šæœ€åç”Ÿè¿˜è€…ã€‹å‰§æƒ…çš„â€œå¦‚æœï¼ˆWhat-Ifï¼‰â€å‡è®¾åœºæ™¯ã€‚è¯·æ¨æ¼”è¿™ä¸ªæ”¹å˜å¼•å‘çš„è´è¶æ•ˆåº”ï¼Œç®€è¦æè¿°å®ƒå°†å¦‚ä½•æ”¹å˜è§’è‰²çš„å‘½è¿ã€å…³é”®å‰§æƒ…èŠ‚ç‚¹ä»¥åŠæ¸¸æˆçš„æ ¸å¿ƒä¸»é¢˜ï¼ˆå¦‚çˆ±ä¸è‡ªç§ï¼‰ã€‚å›ç­”é™åˆ¶åœ¨200å­—ä»¥å†…ï¼Œé£æ ¼éœ€ä¿æŒæ¸¸æˆåŸæœ¬çš„æ²‰é‡ä¸ç°å®æ„Ÿã€‚";
            
            const response = await callGeminiAPI(input, systemPrompt);
            
            const formattedResponse = response.replace(/\*\*(.*?)\*\*/g, '<strong class="text-amber-400">$1</strong>');

            loading.classList.add('hidden');
            resultBox.innerHTML = formattedResponse;
        }

        // --- Data Definitions (Original App Data) ---

        // 1. Narrative System Data
        const systemDetails = [
            {
                title: "ç¨‹åºåŒ–è¡¨æ¼”ä¸NPCäº¤äº’ (NPC Performance)",
                text: "é‡ç½®ç‰ˆåˆ©ç”¨æ›´åŠ å…ˆè¿›çš„é¢éƒ¨æ•æ‰æŠ€æœ¯ï¼Œè®©NPCçš„å¾®è¡¨æƒ…ï¼ˆå¦‚çœ¼ç¥é—ªèº²ã€å˜´è§’æŠ½åŠ¨ï¼‰ä¼ è¾¾å‡ºå‰§æœ¬æ–‡å­—æ— æ³•è¦†ç›–çš„ä¿¡æ¯ã€‚'ä¼™ä¼´ç³»ç»Ÿ'ä¸ä»…ä»…æ˜¯æˆ˜æ–—è¾…åŠ©ï¼Œæ›´æ˜¯ä¸€ä¸ªåŠ¨æ€çš„å™äº‹å‘ç”Ÿå™¨ã€‚è‰¾è‰ä¼šå¯¹ä½ çš„æ½œè¡ŒæˆåŠŸè¡¨ç¤ºæƒŠå¹ï¼Œä¹Ÿä¼šåœ¨ä½ é•¿æ—¶é—´ä¸åŠ¨æ—¶è¡¨ç°å‡ºç„¦èºã€‚è¿™ç§è®¾è®¡è®©è§’è‰²åœ¨Cutsceneä¹‹å¤–ä¾ç„¶ä¿æŒé²œæ´»ã€‚"
            },
            {
                title: "ç¯å¢ƒå™äº‹ (Environmental Storytelling)",
                text: "é¡½çš®ç‹—çš„å…³å¡ç¾æœ¯å³æ˜¯å™äº‹ã€‚ä¾‹å¦‚åœ¨åŒ¹å…¹å ¡ä¸‹æ°´é“ï¼Œé€šè¿‡æ•£è½çš„ç”»ä½œã€è§„åˆ™å®ˆåˆ™å’Œæœ€ç»ˆçš„ä¸€å…·å°¸ä½“ï¼Œå®Œæ•´è®²è¿°äº†ä¸€ä¸ªæƒ³è¦å»ºç«‹ä¹Œæ‰˜é‚¦å´æœ€ç»ˆå¤±è´¥çš„ç¤¾ç¾¤æ•…äº‹ã€‚è¿™ç§ç¢ç‰‡åŒ–å™äº‹é¼“åŠ±ç©å®¶ä¸»åŠ¨æ¢ç´¢ï¼Œè€Œéè¢«åŠ¨æ¥å—ï¼Œæå¤§åœ°å¢å¼ºäº†ä¸–ç•Œçš„çœŸå®æ„Ÿå’Œå†å²åšé‡æ„Ÿã€‚"
            },
            {
                title: "æ¸¸æˆæœºåˆ¶ä¸å™äº‹çš„ç»Ÿä¸€ (Ludonarrative Consistency)",
                text: "è®¸å¤šæ¸¸æˆå­˜åœ¨'å™äº‹å¤±è°ƒ'ï¼ˆå‰§æƒ…é‡Œæ˜¯å¥½äººï¼Œç©æ³•é‡Œæ€äººå¦‚éº»ï¼‰ï¼Œä½†TLOUé€šè¿‡è®¾å®šæç«¯çš„æœ«ä¸–ç¯å¢ƒè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä¹”å°”çš„è¿‘æˆ˜åŠ¨ä½œæ®‹æš´ä¸”æ²‰é‡ï¼Œä¸ä»…åé¦ˆäº†æ‰“å‡»æ„Ÿï¼Œæ›´åœ¨å™äº‹å±‚é¢å¼ºè°ƒäº†ä»–ä¸ºäº†ç”Ÿå­˜ä¸æ‹©æ‰‹æ®µçš„æ€§æ ¼ã€‚æ¯ä¸€æ¬¡èµ„æºçš„æ‹¾å–éƒ½ä¼´éšç€æ¸…è„†çš„éŸ³æ•ˆï¼Œå¼ºåŒ–äº†ç‰©èµ„çš„çè´µå’Œç”Ÿå­˜çš„å‹åŠ›ã€‚"
            }
        ];

        // 2. Emotional Curve Data (Chart.js Line)
        const emotionalData = {
            labels: ['åºç« ', 'éš”ç¦»åŒº', 'å¤–å›´', 'æ¯”å°”å°é•‡', 'åŒ¹å…¹å ¡', 'ä¸‹æ°´é“', 'å¤§å', 'å¤§å­¦', 'æ¹–ç•”(å†¬)', 'å…¬è½¦ç«™', 'åŒ»é™¢', 'å°¾å£°'],
            tension: [90, 60, 50, 65, 80, 75, 40, 55, 95, 30, 85, 20], // Survival/Danger Stress
            bonding: [10, 10, 20, 30, 45, 55, 70, 80, 90, 95, 95, 60]  // Joel & Ellie Relationship
        };

        // 3. Season Content Data
        const seasonContent = {
            summer: {
                title: "å¤å­£ï¼šç›¸é‡ä¸è¢«è¿«çš„æ—…ç¨‹",
                text: "<strong>ä¸»é¢˜ï¼šå¤±å»ä¸è´£ä»»ã€‚</strong><br>æ•…äº‹å»ºç«‹åœ¨ä¹”å°”ä¸§å¥³çš„å·¨å¤§åˆ›ä¼¤ä¹‹ä¸Šã€‚å¤å­£ç« èŠ‚å……æ»¡äº†ä¸ä¿¡ä»»å’Œå†²çªã€‚ä¹”å°”å°†è‰¾è‰è§†ä¸º'è´§ç‰©'ï¼Œè‰¾è‰åˆ™å¯¹å¤–éƒ¨ä¸–ç•Œå……æ»¡å¥½å¥‡ä½†ç¬¨æ‹™ã€‚æ¯”å°”å°é•‡å±•ç¤ºäº†'å­¤ç‹¬ç”Ÿå­˜è€…'çš„æ‚²å‰§ç»“å±€ï¼Œè¿™æ˜¯ç»™ä¹”å°”çš„ä¸€é¢é•œå­â€”â€”å¦‚æœæ²¡æœ‰çˆ±ï¼Œç”Ÿå­˜åªæ˜¯è¡Œå°¸èµ°è‚‰ã€‚",
                highlights: "æ³°ä¸ä¹‹æ­»ã€æ¯”å°”çš„è­¦å‘Šã€åŒ¹å…¹å ¡çš„ä¼å‡»"
            },
            fall: {
                title: "ç§‹å­£ï¼šå…³ç³»çš„è½¬æŠ˜ç‚¹",
                text: "<strong>ä¸»é¢˜ï¼šå†²çªä¸æ¥çº³ã€‚</strong><br>ç§‹å­£æ˜¯ä¸¤äººå…³ç³»çš„ç†”ç‚‰ã€‚åœ¨æ±¤ç±³å¤§åï¼Œä¹”å°”è¯•å›¾å°†è‰¾è‰'ç”©åŒ…è¢±'ç»™æ±¤ç±³ï¼Œå¼•å‘äº†è‘—åçš„'ä½ ä¸æ˜¯æˆ‘å¥³å„¿'äº‰åµã€‚è¿™æ¬¡äº‰åµåè€Œæˆä¸ºäº†ä¸¤äººçœŸæ­£å»ºç«‹ä¿¡ä»»çš„å¥‘æœºã€‚éšåçš„å¤§å­¦ç« èŠ‚ï¼Œä¸¤äººé…åˆé»˜å¥‘ï¼Œå¯¹è¯å˜å¾—è½»æ¾ï¼Œä¹”å°”å¼€å§‹æ•™è‰¾è‰æ©„æ¦„çƒè§„åˆ™ï¼Œçˆ¶å¥³å…³ç³»é›å½¢åˆç°ã€‚",
                highlights: "å¤§åäº‰åµã€éª‘é©¬è¿›å…¥å¤§å­¦ã€ä¹”å°”é‡ä¼¤"
            },
            winter: {
                title: "å†¬å­£ï¼šè§’è‰²çš„äº’æ¢ä¸æˆé•¿",
                text: "<strong>ä¸»é¢˜ï¼šç‹¬ç«‹ä¸åˆ›ä¼¤ã€‚</strong><br>æ¸¸æˆå™äº‹çš„é«˜å…‰æ—¶åˆ»ã€‚ä¹”å°”ç¼ºå¸­ï¼Œç©å®¶æ§åˆ¶è‰¾è‰ã€‚è¿™ç§è§†è§’çš„è½¬æ¢ä¸ä»…æ˜¯ç©æ³•ä¸Šçš„æ”¹å˜ï¼Œæ›´æ˜¯å™äº‹ä¸Šçš„éšå–»ï¼šè‰¾è‰å¿…é¡»ç‹¬è‡ªé¢å¯¹ä¸–ç•Œçš„çº¯ç²¹æ¶æ„ï¼ˆå¤§å«ï¼‰ã€‚å½“ä¹”å°”è‹é†’å¹¶åœ¨è¿™åœºå™©æ¢¦ä¸­æ‰¾åˆ°è‰¾è‰æ—¶ï¼Œä»–ä¸å†æ˜¯'è¿è´§äºº'ï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ªçˆ¶äº²çš„èº«ä»½å»å®‰æŠšå—æƒŠçš„å­©å­ã€‚",
                highlights: "çŒæ€é›„é¹¿ã€å¤§å«çš„æ¬ºéª—ã€é¤å…å†³æˆ˜ã€'Baby girl'çš„æ‹¥æŠ±"
            },
            spring: {
                title: "æ˜¥å­£ï¼šçˆ±çš„ä»£ä»·",
                text: "<strong>ä¸»é¢˜ï¼šå¸Œæœ›ä¸è°è¨€ã€‚</strong><br>é•¿é¢ˆé¹¿åœºæ™¯æ˜¯å…¨æ¸¸æˆæœ€æ¸©æŸ”çš„ä¸€ç¬”ï¼Œè±¡å¾ç€åœ¨æ®‹é…·ä¸–ç•Œä¸­ä¾ç„¶å­˜ç•™çš„ç¾å¥½ã€‚ç„¶è€Œï¼ŒåŒ»é™¢çš„ç»“å±€å°†ä¸»é¢˜å‡åã€‚ä¹”å°”ä¸ºäº†ä¿å­˜è¿™ä»½ç¾å¥½ï¼ˆè‰¾è‰ï¼‰ï¼Œé€‰æ‹©äº†æ¯ç­å…¨äººç±»çš„å¸Œæœ›ã€‚æœ€åçš„è°è¨€æ˜¯ä¹”å°”è‡ªç§çš„ä½“ç°ï¼Œä¹Ÿæ˜¯ä»–å¯¹è¿™ä»½çˆ¶å¥³å…³ç³»æåº¦çè§†çš„è¯æ˜ã€‚",
                highlights: "é•¿é¢ˆé¹¿åœºæ™¯ã€åŒ»é™¢å¤§å± æ€ã€æœ€åçš„èª“è¨€"
            }
        };

        // 4. Character Radar Data
        const characterData = {
            joel: {
                start: [90, 10, 20, 80], // Survival, Humanity, Trust, Trauma
                end: [95, 70, 90, 90], // Trauma stays high but changes form (fear of loss)
                desc: "ä¹”å°”ï¼šä»ç”Ÿå­˜æœºå™¨åˆ°è‡ªç§çš„çˆ¶äº²",
                text: "æ•…äº‹å¼€å§‹æ—¶ï¼Œä¹”å°”æ˜¯ä¸€ä¸ªæƒ…æ„Ÿæ¯ç«­çš„ç”Ÿå­˜è€…ï¼Œä»–çš„'äººæ€§'æä½ï¼Œä¾é å†·é…·ç»´æŒç”Ÿå­˜ã€‚éšç€æ—…ç¨‹æ¨è¿›ï¼Œè‰¾è‰å”¤é†’äº†ä»–å†…å¿ƒæ·±å¤„çš„çˆ¶çˆ±ï¼Œä½†ä¹Ÿè®©ä»–å˜å¾—æ‚£å¾—æ‚£å¤±ï¼Œæœ€ç»ˆä¸ºäº†è¿™ä»½çˆ±èƒŒå›äº†ä¸–ç•Œã€‚",
                quote: "â€œæˆ‘å¥‹æ–—äº†å¾ˆä¹…ï¼Œæ‰å¾—ä»¥ç”Ÿå­˜è‡³ä»Š...æ— è®ºå¦‚ä½•ï¼Œä½ éƒ½è¦æ‰¾åˆ°ä»¥æ­¤ä¸ºç”Ÿçš„æ„ä¹‰ã€‚â€",
                changes: [
                    {label: "äººæ€§/å¸Œæœ›", val: "å¤§å¹…å›å‡", type: "up"},
                    {label: "ä¿¡ä»»", val: "ä»…å¯¹è‰¾è‰å®Œå…¨æ•å¼€", type: "up"},
                    {label: "åˆ›ä¼¤", val: "è½¬åŒ–ä¸ºå¯¹å¤±å»çš„ææƒ§", type: "neutral"}
                ],
                colors: {
                    bg: 'rgba(34, 197, 94, 0.2)', // Green
                    border: 'rgba(34, 197, 94, 1)'
                }
            },
            ellie: {
                start: [30, 90, 60, 40],
                end: [85, 50, 40, 90], // Less humanity/innocence, higher survival/trauma
                desc: "è‰¾è‰ï¼šçº¯çœŸçš„ä¸§å¤±ä¸ç‹¬ç«‹çš„è§‰é†’",
                text: "è‰¾è‰æœ€åˆä»£è¡¨ç€å¸Œæœ›å’Œçº¯çœŸã€‚ä½†ç»å†å†¬å­£çš„æ®‹é…·å’Œå¤§å«äº‹ä»¶åï¼Œå¥¹è¢«è¿«å¿«é€Ÿæˆé•¿ã€‚ç»“å±€æ—¶çš„å¥¹å˜å¾—æ›´åŠ æ²‰é»˜ã€æ€€ç–‘ï¼Œå¥¹çš„ç”Ÿå­˜æŠ€èƒ½æ»¡ç‚¹ï¼Œä½†å†…å¿ƒçš„å…‰èŠ’è¢«å¹¸å­˜è€…çš„æ„§ç–šæ„Ÿæ‰€ç¬¼ç½©ã€‚",
                quote: "â€œæ¯ä¸ªäººéƒ½ç¦»æˆ‘è€Œå»ï¼Œåªæœ‰ä½ æ²¡æœ‰ã€‚â€",
                changes: [
                    {label: "ç”Ÿå­˜èƒ½åŠ›", val: "ä»ä¾èµ–åˆ°ç‹¬å½“ä¸€é¢", type: "up"},
                    {label: "çº¯çœŸ", val: "å½»åº•ç ´ç¢", type: "down"},
                    {label: "ä¿¡ä»»", val: "å› ä¹”å°”çš„è°è¨€äº§ç”Ÿè£‚ç—•", type: "down"}
                ],
                colors: {
                    bg: 'rgba(239, 68, 68, 0.2)', // Red/Amber
                    border: 'rgba(239, 68, 68, 1)'
                }
            }
        };


        // --- Initialization & Logic ---

        // Chart Instances
        let emotionChart = null;
        let radarChart = null;

        function initCharts() {
            // 1. Emotion Line Chart
            const ctx1 = document.getElementById('emotionalCurveChart').getContext('2d');
            emotionChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: emotionalData.labels,
                    datasets: [
                        {
                            label: 'ç”Ÿå­˜ç´§å¼ åº¦ (Tension)',
                            data: emotionalData.tension,
                            borderColor: '#d97706', // amber-600
                            backgroundColor: 'rgba(217, 119, 6, 0.1)',
                            borderWidth: 2,
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'æƒ…æ„Ÿç¾ç»Š (Bonding)',
                            data: emotionalData.bonding,
                            borderColor: '#22c55e', // green-500
                            backgroundColor: 'rgba(34, 197, 94, 0.1)',
                            borderWidth: 3,
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { labels: { color: '#a8a29e' } },
                        tooltip: {
                            backgroundColor: 'rgba(28, 25, 23, 0.9)',
                            titleColor: '#22c55e',
                            bodyColor: '#e7e5e4',
                            borderColor: '#44403c',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        y: {
                            grid: { color: '#44403c' },
                            ticks: { color: '#a8a29e' },
                            title: { display: true, text: 'å¼ºåº¦ç­‰çº§ (0-100)', color: '#78716c' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { color: '#a8a29e', maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });

            // 2. Character Radar Chart
            const ctx2 = document.getElementById('characterRadarChart').getContext('2d');
            radarChart = new Chart(ctx2, {
                type: 'radar',
                data: {
                    labels: ['ç”Ÿå­˜æŠ€èƒ½', 'äººæ€§/å¸Œæœ›', 'å¯¹ä»–äººçš„ä¿¡ä»»', 'å¿ƒç†åˆ›ä¼¤'],
                    datasets: [
                        {
                            label: 'æ•…äº‹å¼€å§‹ (Start)',
                            data: characterData.joel.start,
                            fill: true,
                            backgroundColor: 'rgba(168, 162, 158, 0.2)', // stone-400
                            borderColor: '#a8a29e',
                            pointBackgroundColor: '#a8a29e',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#a8a29e'
                        },
                        {
                            label: 'æ•…äº‹ç»“æŸ (End)',
                            data: characterData.joel.end,
                            fill: true,
                            backgroundColor: characterData.joel.colors.bg,
                            borderColor: characterData.joel.colors.border,
                            pointBackgroundColor: characterData.joel.colors.border,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: characterData.joel.colors.border
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { borderWidth: 3 } },
                    plugins: {
                        legend: { labels: { color: '#e7e5e4' } }
                    },
                    scales: {
                        r: {
                            angleLines: { color: '#44403c' },
                            grid: { color: '#44403c' },
                            pointLabels: { color: '#e7e5e4', font: { size: 12, weight: 'bold' } },
                            ticks: { display: false, backdropColor: 'transparent' },
                            suggestedMin: 0,
                            suggestedMax: 100
                        }
                    }
                }
            });
        }

        // --- Interaction Functions ---

        function updateSystemDetail(index) {
            const box = document.getElementById('system-detail-box');
            const title = document.getElementById('sys-detail-title');
            const text = document.getElementById('sys-detail-text');
            
            box.classList.remove('hidden');
            box.classList.add('block', 'animate-fade-in'); // Simple visual cue
            
            title.textContent = systemDetails[index].title;
            text.textContent = systemDetails[index].text;
        }

        function updateSeasonData(season) {
            const data = seasonContent[season];
            const container = document.getElementById('season-content');
            
            // Visual feedback for buttons
            document.querySelectorAll('.season-btn').forEach(btn => btn.classList.remove('active'));
            // Since buttons have onclick inline, we use event.currentTarget logic inside buttons or manual targeting. 
            // Simplified: Find button by partial text or just rebuild logic. 
            // For this output, we'll just update the content HTML.
            // *Correction*: Let's select by attribute or index for cleaner code in a real app, 
            // but here we just update the content HTML.
            
            // Update button styles manually for the "active" class simulation
            // (In a full React app we'd use state, here we do DOM manipulation)
            const buttons = document.querySelectorAll('.season-btn');
            if(season === 'summer') { buttons.forEach(b=>b.classList.remove('active')); buttons[0].classList.add('active'); }
            if(season === 'fall') { buttons.forEach(b=>b.classList.remove('active')); buttons[1].classList.add('active'); }
            if(season === 'winter') { buttons.forEach(b=>b.classList.remove('active')); buttons[2].classList.add('active'); }
            if(season === 'spring') { buttons.forEach(b=>b.classList.remove('active')); buttons[3].classList.add('active'); }

            container.innerHTML = `
                <h4 class="text-green-500 font-bold mb-2 text-lg">${data.title}</h4>
                <p class="text-sm text-stone-300 leading-relaxed mb-4">${data.text}</p>
                <div class="bg-stone-900/50 p-3 rounded border border-stone-700">
                    <span class="text-xs text-stone-500 uppercase font-bold block mb-1">å…³é”®æƒ…èŠ‚ç‚¹ (Key Beats)</span>
                    <span class="text-sm text-stone-200">${data.highlights}</span>
                </div>
            `;
        }

        function updateCharacterChart(charName) {
            const data = characterData[charName];
            
            // Update Text
            const descArea = document.getElementById('char-desc');
            
            // Build the list items HTML
            const listHtml = data.changes.map(item => {
                const icon = item.type === 'up' ? '<span class="text-green-500 mr-2">â–²</span>' : 
                             (item.type === 'down' ? '<span class="text-red-500 mr-2">â–¼</span>' : '<span class="text-amber-500 mr-2">â—</span>');
                return `<li class="flex items-center text-sm text-stone-400">${icon} <span>${item.label}ï¼š${item.val}</span></li>`;
            }).join('');

            descArea.innerHTML = `
                <h3 class="text-2xl font-bold text-stone-100">${data.desc}</h3>
                <p class="text-stone-300 mt-2">${data.text}</p>
                <p class="text-stone-300 border-l-2 border-stone-600 pl-4 italic mt-4">${data.quote}</p>
                <ul class="space-y-2 mt-4 bg-stone-900/50 p-4 rounded-lg">
                    ${listHtml}
                </ul>
            `;

            // Update Buttons
            const btnJoel = document.getElementById('btn-joel');
            const btnEllie = document.getElementById('btn-ellie');
            
            if(charName === 'joel') {
                btnJoel.classList.replace('bg-stone-800', 'bg-stone-700');
                btnJoel.classList.replace('text-stone-400', 'text-white');
                btnJoel.classList.add('border-green-600');
                btnJoel.classList.remove('border-transparent');
                
                btnEllie.classList.replace('bg-stone-700', 'bg-stone-800');
                btnEllie.classList.replace('text-white', 'text-stone-400');
                btnEllie.classList.remove('border-green-600');
                btnEllie.classList.add('border-transparent');
            } else {
                btnEllie.classList.replace('bg-stone-800', 'bg-stone-700');
                btnEllie.classList.replace('text-stone-400', 'text-white');
                btnEllie.classList.add('border-green-600');
                btnEllie.classList.remove('border-transparent');

                btnJoel.classList.replace('bg-stone-700', 'bg-stone-800');
                btnJoel.classList.replace('text-white', 'text-stone-400');
                btnJoel.classList.remove('border-green-600');
                btnJoel.classList.add('border-transparent');
            }

            // Update Chart
            radarChart.data.datasets[0].data = data.start;
            radarChart.data.datasets[1].data = data.end;
            radarChart.data.datasets[1].backgroundColor = data.colors.bg;
            radarChart.data.datasets[1].borderColor = data.colors.border;
            radarChart.data.datasets[1].pointBackgroundColor = data.colors.border;
            radarChart.data.datasets[1].pointHoverBorderColor = data.colors.border;
            radarChart.update();
        }

        function expandTheme(card, type) {
            // Collapse all others
            document.querySelectorAll('.theme-card .hidden-content').forEach(el => el.classList.add('hidden'));
            
            // Expand clicked
            const content = card.querySelector('.hidden-content');
            content.classList.remove('hidden');
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
        }

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            initCharts();
            // Default select Summer
            updateSeasonData('summer');
        });

    </script>
</body>
</html>